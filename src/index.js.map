{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":";AAAA,MAAY,GAAG,WAAM,KAAK,CAAC,CAAA;AAC3B,2BAAuB,UAAU,CAAC,CAAA;AAClC,2BAAiC,YAAY,CAAC,CAAA;AAC9C,yBAAsB,UAAU,CAAC,CAAA;AACjC,yBAAsB,UAAU,CAAC,CAAA;AAEjC;IACC,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC;IAExB,EAAE,CAAC,CAAC,GAAG,CAAC,yBAAyB,IAAI,GAAG,CAAC,yBAAyB,CAAC,CAAC,CAAC;QACpE,MAAM,CAAC,aAAa,GAAG,CAAC,yBAAyB,IAAI,GAAG,CAAC,yBAAyB,WAAW,CAAC;IAC/F,CAAC;IAED,EAAE,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC;QACtB,MAAM,CAAC,GAAG,CAAC,YAAY,CAAC;IACzB,CAAC;IAED,EAAE,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC;QACtB,MAAM,CAAC,GAAG,CAAC,YAAY,CAAC;IACzB,CAAC;IACD,MAAM,CAAC,8BAA8B,CAAC;AACvC,CAAC;AAED,MAAM,GAAG,GAAG,IAAI,GAAG,EAAE,CAAC;AACtB,MAAM,QAAQ,GAAG,IAAI,mBAAQ,EAAE,CAAC;AAChC,QAAQ,CAAC,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC,GAAQ;IAC3C,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QACT,OAAO,CAAC,KAAK,CAAC,8BAA8B,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC;QAC3D,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IACjB,CAAC;AACF,CAAC,CAAC,CAAC;AAEH,MAAM,MAAM,GAAG,gBAAS,CAAC,QAAQ,CAAC,CAAC;AACnC,MAAM,MAAM,GAAG,gBAAS,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;AAEtC,GAAG;KACD,GAAG,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,CAAC;KACpC,GAAG,CAAC,6BAAkB,CAAC;KACvB,GAAG,CAAC,MAAM,CAAC,cAAc,EAAE,CAAC;KAC5B,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC;AAEvB,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,CAAC","sourcesContent":["import * as Koa from 'koa';\r\nimport {Mongoose} from 'mongoose';\r\nimport {catapultMiddleware} from './catapult';\r\nimport getModels from './models';\r\nimport getRouter from './routes';\r\n\r\nfunction getDatabaseUrl(): string {\r\n\tconst env = process.env;\r\n\t// Docker support\r\n\tif (env.MONGO_PORT_27017_TCP_ADDR && env.MONGO_PORT_27017_TCP_PORT) {\r\n\t\treturn `mongodb://${env.MONGO_PORT_27017_TCP_ADDR}:${env.MONGO_PORT_27017_TCP_PORT}/voiceApp`;\r\n\t}\r\n\t// Momgolab instances support\r\n\tif (env.MONGOLAB_URI) {\r\n\t\treturn env.MONGOLAB_URI;\r\n\t}\r\n\t// via DATABASE_URL\r\n\tif (env.DATABASE_URL) {\r\n\t\treturn env.DATABASE_URL;\r\n\t}\r\n\treturn 'mongodb://localhost/voiceApp';\r\n}\r\n\r\nconst app = new Koa();\r\nconst mongoose = new Mongoose();\r\nmongoose.connect(getDatabaseUrl(), (err: any) => {\r\n\tif (err) {\r\n\t\tconsole.error(`Error on connecting to DB: ${err.message}`);\r\n\t\tprocess.exit(1);\r\n\t}\r\n});\r\n\r\nconst models = getModels(mongoose);\r\nconst router = getRouter(app, models);\r\n\r\napp\r\n\t.use(require('koa-static')('public'))\r\n\t.use(catapultMiddleware)\r\n\t.use(router.allowedMethods())\r\n\t.use(router.routes());\r\n\r\napp.listen(process.env.PORT || 3000);\r\n"]}