{"version":3,"file":"index.js","sourceRoot":"","sources":["../index.ts"],"names":[],"mappings":";AAAA,MAAY,GAAG,WAAM,KAAK,CAAC,CAAA;AAC3B,2BAAuB,UAAU,CAAC,CAAA;AAClC,2BAAiC,gBAAgB,CAAC,CAAA;AAClD,yBAAsB,cAAc,CAAC,CAAA;AACrC,yBAAsB,cAAc,CAAC,CAAA;AAErC;IACE,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC;IACxB,EAAE,CAAA,CAAC,GAAG,CAAC,yBAAyB,IAAI,GAAG,CAAC,yBAAyB,CAAC,CAAC,CAAC;QAClE,MAAM,CAAC,aAAa,GAAG,CAAC,yBAAyB,IAAI,GAAG,CAAC,yBAAyB,WAAW,CAAC;IAChG,CAAC;IACD,EAAE,CAAA,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC;QACpB,MAAM,CAAC,GAAG,CAAC,YAAY,CAAC;IAC1B,CAAC;IACD,EAAE,CAAA,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC;QACpB,MAAM,CAAC,GAAG,CAAC,YAAY,CAAC;IAC1B,CAAC;IACD,MAAM,CAAC,8BAA8B,CAAC;AACxC,CAAC;AAED,MAAM,GAAG,GAAG,IAAI,GAAG,EAAE,CAAC;AACtB,MAAM,QAAQ,GAAG,IAAI,mBAAQ,EAAE,CAAC;AAChC,QAAQ,CAAC,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC,GAAQ;IAC1C,EAAE,CAAA,CAAC,GAAG,CAAC,CAAA,CAAC;QACN,OAAO,CAAC,KAAK,CAAC,8BAA8B,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC;QAC3D,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAClB,CAAC;AACH,CAAC,CAAC,CAAC;AAEH,MAAM,MAAM,GAAG,gBAAS,CAAC,QAAQ,CAAC,CAAC;AACnC,MAAM,MAAM,GAAG,gBAAS,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;AAEtC,GAAG;KACA,GAAG,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,CAAC;KACpC,GAAG,CAAC,6BAAkB,CAAC;KACvB,GAAG,CAAC,MAAM,CAAC,cAAc,EAAE,CAAC;KAC7B,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC;AAEvB,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,CAAC","sourcesContent":["import * as Koa from 'koa';\r\nimport {Mongoose} from 'mongoose';\r\nimport {catapultMiddleware} from './lib/catapult';\r\nimport getModels from './lib/models';\r\nimport getRouter from './lib/routes';\r\n\r\nfunction getDatabaseUrl(): string {\r\n  const env = process.env;\r\n  if(env.MONGO_PORT_27017_TCP_ADDR && env.MONGO_PORT_27017_TCP_PORT) {\r\n    return `mongodb://${env.MONGO_PORT_27017_TCP_ADDR}:${env.MONGO_PORT_27017_TCP_PORT}/voiceApp`;\r\n  }\r\n  if(env.MONGOLAB_URI) {\r\n    return env.MONGOLAB_URI;\r\n  }\r\n  if(env.DATABASE_URL) {\r\n    return env.DATABASE_URL;\r\n  }\r\n  return 'mongodb://localhost/voiceApp';\r\n}\r\n\r\nconst app = new Koa();\r\nconst mongoose = new Mongoose();\r\nmongoose.connect(getDatabaseUrl(), (err: any) => {\r\n  if(err){\r\n    console.error(`Error on connecting to DB: ${err.message}`);\r\n    process.exit(1);\r\n  }\r\n});\r\n\r\nconst models = getModels(mongoose);\r\nconst router = getRouter(app, models);\r\n\r\napp\r\n  .use(require('koa-static')('public'))\r\n  .use(catapultMiddleware)\r\n  .use(router.allowedMethods())\r\n\t.use(router.routes());\r\n\r\napp.listen(process.env.PORT || 3000);\r\n"]}