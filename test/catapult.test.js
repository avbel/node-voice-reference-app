"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator.throw(value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments)).next());
    });
};
const ava_1 = require('ava');
const sinon = require('sinon');
const randomstring = require('randomstring');
const catapult_1 = require('../src/catapult');
const helpers_1 = require('./helpers');
sinon.stub(randomstring, 'generate').returns('random');
ava_1.default(`buildAbsoluteUrl() should build right absolute url`, (t) => __awaiter(this, void 0, void 0, function* () {
    const ctx = helpers_1.createContext();
    t.is(catapult_1.buildAbsoluteUrl(ctx, '/path1'), 'http://localhost/path1');
    t.is(catapult_1.buildAbsoluteUrl(ctx, 'path2'), 'http://localhost/path2');
    ctx.request.req.headers['x-forwarded-proto'] = 'https';
    t.is(catapult_1.buildAbsoluteUrl(ctx, '/path3'), 'https://localhost/path3');
}));
ava_1.default(`CatapultApi#getApplicationId should return existing application id If the app exists`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const applications = [
        { id: 'appId', name: 'NodeJSVoiceReferenceApp on localhost' }
    ];
    const stub1 = sinon.stub(api.catapult.Application, 'list')
        .withArgs({ size: 1000 })
        .returns(Promise.resolve({ applications: applications }));
    t.is(yield api.getApplicationId(helpers_1.createContext()), 'appId');
    t.true(stub1.called);
}));
ava_1.default(`CatapultApi#getApplicationId should return cached application id on second call`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const applications = [
        { id: 'appId', name: 'NodeJSVoiceReferenceApp on localhost' }
    ];
    const stub1 = sinon.stub(api.catapult.Application, 'list')
        .withArgs({ size: 1000 })
        .returns(Promise.resolve({ applications: applications }));
    t.is(yield api.getApplicationId(helpers_1.createContext()), 'appId');
    t.is(yield api.getApplicationId(helpers_1.createContext()), 'appId');
    t.is(stub1.callCount, 1);
}));
ava_1.default(`CatapultApi#getApplicationId should create new app`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const stub1 = sinon.stub(api.catapult.Application, 'list')
        .withArgs({ size: 1000 })
        .returns(Promise.resolve({ applications: [] }));
    const stub2 = sinon.stub(api.catapult.Application, 'create')
        .withArgs({
        name: 'NodeJSVoiceReferenceApp on localhost',
        autoAnswer: true,
        incomingCallUrl: 'http://localhost/callCallback'
    })
        .returns(Promise.resolve({ id: 'appId' }));
    t.is(yield api.getApplicationId(helpers_1.createContext()), 'appId');
    t.true(stub1.called);
    t.true(stub2.called);
}));
ava_1.default(`CatapultApi#getDomain should return existing domain info if the domain exists`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const domains = [
        { id: 'domainId', name: 'domain', description: `NodeJSVoiceReferenceApp's domain` }
    ];
    const stub1 = sinon.stub(api.catapult.Domain, 'list')
        .withArgs({ size: 100 })
        .returns(Promise.resolve({ domains: domains }));
    t.deepEqual(yield api.getDomain(helpers_1.createContext()), { id: 'domainId', name: 'domain' });
    t.true(stub1.called);
}));
ava_1.default(`CatapultApi#getDomain should return cached domain info on second call`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const domains = [
        { id: 'domainId', name: 'domain', description: `NodeJSVoiceReferenceApp's domain` }
    ];
    const stub1 = sinon.stub(api.catapult.Domain, 'list')
        .withArgs({ size: 100 })
        .returns(Promise.resolve({ domains: domains }));
    t.deepEqual(yield api.getDomain(helpers_1.createContext()), { id: 'domainId', name: 'domain' });
    t.deepEqual(yield api.getDomain(helpers_1.createContext()), { id: 'domainId', name: 'domain' });
    t.is(stub1.callCount, 1);
}));
ava_1.default(`CatapultApi#getDomain should create new domain`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const name = 'randomrandom';
    const stub1 = sinon.stub(api.catapult.Domain, 'list')
        .withArgs({ size: 100 })
        .returns(Promise.resolve({ domains: [] }));
    const stub2 = sinon.stub(api.catapult.Domain, 'create')
        .withArgs({ name: name, description: `NodeJSVoiceReferenceApp's domain` })
        .returns(Promise.resolve({ id: 'domainId', name: name }));
    t.deepEqual(yield api.getDomain(helpers_1.createContext()), { id: 'domainId', name: name });
    t.true(stub1.called);
    t.true(stub2.called);
}));
ava_1.default(`CatapultApi#createPhoneNumber should search and register a phone number`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const stub1 = sinon.stub(api.catapult.AvailableNumber, 'searchAndOrder')
        .withArgs('local', { areaCode: '910', quantity: 1 })
        .returns(Promise.resolve([{ id: 'id', number: '+1234567890' }]));
    const stub2 = sinon.stub(api.catapult.PhoneNumber, 'update')
        .withArgs('id', { applicationId: 'appId' })
        .returns(Promise.resolve());
    const stub3 = sinon.stub(api, 'getApplicationId')
        .returns(Promise.resolve('appId'));
    t.is(yield api.createPhoneNumber(helpers_1.createContext(), '910'), '+1234567890');
    t.true(stub1.called);
    t.true(stub2.called);
    t.true(stub3.called);
}));
ava_1.default(`CatapultApi#createSIPAccount should create sip account for the app`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const stub1 = sinon.stub(api.catapult.Endpoint, 'create')
        .withArgs('domainId', {
        applicationId: 'appId',
        domainId: 'domainId',
        name: 'vu-random',
        description: `NodeJSVoiceReferenceApp's SIP Account`,
        credentials: { password: 'random' }
    })
        .returns(Promise.resolve({ id: 'id' }));
    const stub2 = sinon.stub(api, 'getApplicationId')
        .returns(Promise.resolve('appId'));
    const stub3 = sinon.stub(api, 'getDomain')
        .returns(Promise.resolve({ id: 'domainId', name: 'domain' }));
    t.deepEqual(yield api.createSIPAccount(helpers_1.createContext()), {
        endpointId: 'id',
        uri: 'sip:vu-random@domain.bwapp.bwsip.io',
        password: 'random'
    });
    t.true(stub1.called);
    t.true(stub2.called);
    t.true(stub3.called);
}));
ava_1.default(`CatapultApi#createSIPAuthToken should create auth token for SIP account`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const stub1 = sinon.stub(api, 'getDomain')
        .returns(Promise.resolve({ id: 'domainId', name: 'domain' }));
    const stub2 = sinon.stub(api.catapult.Endpoint, 'createAuthToken')
        .withArgs('domainId', 'endpointId', { expires: 3600 })
        .returns(Promise.resolve({ expires: 3600, token: 'token' }));
    t.deepEqual(yield api.createSIPAuthToken(helpers_1.createContext(), 'endpointId'), { expires: 3600, token: 'token' });
    t.true(stub1.called);
    t.true(stub2.called);
}));
ava_1.default(`CatapultApi#createBridge should create a bridge`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const data = { callIds: ['callId'] };
    const stub = sinon.stub(api.catapult.Bridge, 'create')
        .withArgs(data)
        .returns(Promise.resolve({ id: 'id' }));
    t.is(yield api.createBridge(data), 'id');
    t.true(stub.called);
}));
ava_1.default(`CatapultApi#createCall should create a bridge`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const data = { from: 'number1', to: 'number2' };
    const stub = sinon.stub(api.catapult.Call, 'create')
        .withArgs(data)
        .returns(Promise.resolve({ id: 'id' }));
    t.is(yield api.createCall(data), 'id');
    t.true(stub.called);
}));
ava_1.default(`CatapultApi#createGather should create a gather for a call`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const data = { maxDigits: 1 };
    const stub = sinon.stub(api.catapult.Call, 'createGather')
        .withArgs('callId', data)
        .returns(Promise.resolve({ id: 'id' }));
    t.is(yield api.createGather('callId', data), 'id');
    t.true(stub.called);
}));
ava_1.default(`CatapultApi#updateCall should update call data`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const data = { state: 'completed' };
    const stub = sinon.stub(api.catapult.Call, 'update')
        .withArgs('callId', data)
        .returns(Promise.resolve());
    yield api.updateCall('callId', data);
    t.true(stub.called);
}));
ava_1.default(`CatapultApi#stopPlayAudioToCall should stop audio`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const stub = sinon.stub(api.catapult.Call, 'playAudioAdvanced')
        .withArgs('callId', { fileUrl: '' })
        .returns(Promise.resolve());
    yield api.stopPlayAudioToCall('callId');
    t.true(stub.called);
}));
ava_1.default(`CatapultApi#playAudioToCall should play audio file`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const stub = sinon.stub(api.catapult.Call, 'playAudioAdvanced')
        .withArgs('callId', { fileUrl: 'url', tag: 'tag', loopEnabled: false })
        .returns(Promise.resolve());
    yield api.playAudioToCall('callId', 'url', false, 'tag');
    t.true(stub.called);
}));
ava_1.default(`CatapultApi#speakSentenceToCall should speak a sentence`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const stub = sinon.stub(api.catapult.Call, 'playAudioAdvanced')
        .withArgs('callId', { sentence: 'Hello', tag: 'tag' })
        .returns(Promise.resolve());
    yield api.speakSentenceToCall('callId', 'Hello', 'tag');
    t.true(stub.called);
}));
ava_1.default(`CatapultApi#transferCall should transfer call to another call`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const stub = sinon.stub(api.catapult.Call, 'transfer')
        .withArgs('callId', { transferTo: '+1234567890', transferCallerId: 'callerId' })
        .returns(Promise.resolve({ id: 'id' }));
    t.is(yield api.transferCall('callId', '+1234567890', 'callerId'), 'id');
    t.true(stub.called);
}));
ava_1.default(`CatapultApi#getCall should return a call data`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const stub = sinon.stub(api.catapult.Call, 'get')
        .withArgs('callId')
        .returns(Promise.resolve({ callId: 'id' }));
    t.deepEqual(yield api.getCall('callId'), { callId: 'id' });
    t.true(stub.called);
}));
ava_1.default(`CatapultApi#getRecording should return a call data`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const stub = sinon.stub(api.catapult.Recording, 'get')
        .withArgs('recordingId')
        .returns(Promise.resolve({ media: 'url' }));
    t.deepEqual(yield api.getRecording('recordingId'), { media: 'url' });
    t.true(stub.called);
}));
ava_1.default(`CatapultApi#hangup should complete a call`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const stub = sinon.stub(api.catapult.Call, 'update')
        .withArgs('callId', { state: 'completed' })
        .returns(Promise.resolve());
    yield api.hangup('callId');
    t.true(stub.called);
}));
ava_1.default(`CatapultApi#downloadMediaFile should download a media file`, (t) => __awaiter(this, void 0, void 0, function* () {
    const api = createCatapultApi();
    const data = { content: '1234', contentType: 'text/plain' };
    const stub = sinon.stub(api.catapult.Media, 'download')
        .withArgs('name')
        .returns(Promise.resolve(data));
    t.deepEqual(yield api.downloadMediaFile('name'), data);
    t.true(stub.called);
}));
function createCatapultApi() {
    return new catapult_1.CatapultApi('userId', 'apiToken', 'apiSecret');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2F0YXB1bHQudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNhdGFwdWx0LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsc0JBQWlCLEtBQUssQ0FBQyxDQUFBO0FBQ3ZCLE1BQVksS0FBSyxXQUFNLE9BQU8sQ0FBQyxDQUFBO0FBQy9CLE1BQVksWUFBWSxXQUFNLGNBQWMsQ0FBQyxDQUFBO0FBQzdDLDJCQUEwRCxpQkFBaUIsQ0FBQyxDQUFBO0FBRTVFLDBCQUE0QixXQUFXLENBQUMsQ0FBQTtBQUV4QyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFHdkQsYUFBSSxDQUFDLG9EQUFvRCxFQUFFLENBQU8sQ0FBQztJQUNsRSxNQUFNLEdBQUcsR0FBRyx1QkFBYSxFQUFFLENBQUM7SUFDNUIsQ0FBQyxDQUFDLEVBQUUsQ0FBQywyQkFBZ0IsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLEVBQUUsd0JBQXdCLENBQUMsQ0FBQztJQUNoRSxDQUFDLENBQUMsRUFBRSxDQUFDLDJCQUFnQixDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsRUFBRSx3QkFBd0IsQ0FBQyxDQUFDO0lBQy9ELEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLE9BQU8sQ0FBQztJQUN2RCxDQUFDLENBQUMsRUFBRSxDQUFDLDJCQUFnQixDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO0FBQ2xFLENBQUMsQ0FBQSxDQUFDLENBQUM7QUFFSCxhQUFJLENBQUMsc0ZBQXNGLEVBQUUsQ0FBTyxDQUFDO0lBQ3BHLE1BQU0sR0FBRyxHQUFHLGlCQUFpQixFQUFFLENBQUM7SUFDaEMsTUFBTSxZQUFZLEdBQUc7UUFDcEIsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFB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akMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN2RCxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNyQixDQUFDLENBQUEsQ0FBQyxDQUFDO0FBRUg7SUFDQyxNQUFNLENBQUMsSUFBSSxzQkFBVyxDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDM0QsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0ZXN0IGZyb20gJ2F2YSc7XG5pbXBvcnQgKiBhcyBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgKiBhcyByYW5kb21zdHJpbmcgZnJvbSAncmFuZG9tc3RyaW5nJztcbmltcG9ydCB7YnVpbGRBYnNvbHV0ZVVybCwgQ2F0YXB1bHRBcGksIElDYXRhcHVsdEFwaX0gZnJvbSAnLi4vc3JjL2NhdGFwdWx0JztcbmltcG9ydCB7SUNvbnRleHR9IGZyb20gJy4uL3NyYy9yb3V0ZXMnO1xuaW1wb3J0IHtjcmVhdGVDb250ZXh0fSBmcm9tICcuL2hlbHBlcnMnO1xuXG5zaW5vbi5zdHViKHJhbmRvbXN0cmluZywgJ2dlbmVyYXRlJykucmV0dXJucygncmFuZG9tJyk7XG5cblxudGVzdChgYnVpbGRBYnNvbHV0ZVVybCgpIHNob3VsZCBidWlsZCByaWdodCBhYnNvbHV0ZSB1cmxgLCBhc3luYyAodCkgPT4ge1xuXHRjb25zdCBjdHggPSBjcmVhdGVDb250ZXh0KCk7XG5cdHQuaXMoYnVpbGRBYnNvbHV0ZVVybChjdHgsICcvcGF0aDEnKSwgJ2h0dHA6Ly9sb2NhbGhvc3QvcGF0aDEnKTtcblx0dC5pcyhidWlsZEFic29sdXRlVXJsKGN0eCwgJ3BhdGgyJyksICdodHRwOi8vbG9jYWxob3N0L3BhdGgyJyk7XG5cdGN0eC5yZXF1ZXN0LnJlcS5oZWFkZXJzWyd4LWZvcndhcmRlZC1wcm90byddID0gJ2h0dHBzJztcblx0dC5pcyhidWlsZEFic29sdXRlVXJsKGN0eCwgJy9wYXRoMycpLCAnaHR0cHM6Ly9sb2NhbGhvc3QvcGF0aDMnKTtcbn0pO1xuXG50ZXN0KGBDYXRhcHVsdEFwaSNnZXRBcHBsaWNhdGlvbklkIHNob3VsZCByZXR1cm4gZXhpc3RpbmcgYXBwbGljYXRpb24gaWQgSWYgdGhlIGFwcCBleGlzdHNgLCBhc3luYyAodCkgPT4ge1xuXHRjb25zdCBhcGkgPSBjcmVhdGVDYXRhcHVsdEFwaSgpO1xuXHRjb25zdCBhcHBsaWNhdGlvbnMgPSBbXG5cdFx0e1x0aWQ6ICdhcHBJZCcsXHRuYW1lOiAnTm9kZUpTVm9pY2VSZWZlcmVuY2VBcHAgb24gbG9jYWxob3N0JyB9XG5cdF07XG5cdGNvbnN0IHN0dWIxID0gc2lub24uc3R1YigoPGFueT5hcGkpLmNhdGFwdWx0LkFwcGxpY2F0aW9uLCAnbGlzdCcpXG5cdFx0LndpdGhBcmdzKHsgc2l6ZTogMTAwMCB9KVxuXHRcdC5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSh7YXBwbGljYXRpb25zfSkpO1xuXHR0LmlzKGF3YWl0ICg8YW55PmFwaSkuZ2V0QXBwbGljYXRpb25JZChjcmVhdGVDb250ZXh0KCkpLCAnYXBwSWQnKTtcblx0dC50cnVlKHN0dWIxLmNhbGxlZCk7XG59KTtcblxudGVzdChgQ2F0YXB1bHRBcGkjZ2V0QXBwbGljYXRpb25JZCBzaG91bGQgcmV0dXJuIGNhY2hlZCBhcHBsaWNhdGlvbiBpZCBvbiBzZWNvbmQgY2FsbGAsIGFzeW5jICh0KSA9PiB7XG5cdGNvbnN0IGFwaSA9IGNyZWF0ZUNhdGFwdWx0QXBpKCk7XG5cdGNvbnN0IGFwcGxpY2F0aW9ucyA9IFtcblx0XHR7XHRpZDogJ2FwcElkJyxcdG5hbWU6ICdOb2RlSlNWb2ljZVJlZmVyZW5jZUFwcCBvbiBsb2NhbGhvc3QnIH1cblx0XTtcblx0Y29uc3Qgc3R1YjEgPSBzaW5vbi5zdHViKCg8YW55PmFwaSkuY2F0YXB1bHQuQXBwbGljYXRpb24sICdsaXN0Jylcblx0XHQud2l0aEFyZ3MoeyBzaXplOiAxMDAwIH0pXG5cdFx0LnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHthcHBsaWNhdGlvbnN9KSk7XG5cdHQuaXMoYXdhaXQgKDxhbnk+YXBpKS5nZXRBcHBsaWNhdGlvbklkKGNyZWF0ZUNvbnRleHQoKSksICdhcHBJZCcpO1xuXHR0LmlzKGF3YWl0ICg8YW55PmFwaSkuZ2V0QXBwbGljYXRpb25JZChjcmVhdGVDb250ZXh0KCkpLCAnYXBwSWQnKTtcblx0dC5pcyhzdHViMS5jYWxsQ291bnQsIDEpO1xufSk7XG5cbnRlc3QoYENhdGFwdWx0QXBpI2dldEFwcGxpY2F0aW9uSWQgc2hvdWxkIGNyZWF0ZSBuZXcgYXBwYCwgYXN5bmMgKHQpID0+IHtcblx0Y29uc3QgYXBpID0gY3JlYXRlQ2F0YXB1bHRBcGkoKTtcblx0Y29uc3Qgc3R1YjEgPSBzaW5vbi5zdHViKCg8YW55PmFwaSkuY2F0YXB1bHQuQXBwbGljYXRpb24sICdsaXN0Jylcblx0XHQud2l0aEFyZ3MoeyBzaXplOiAxMDAwIH0pXG5cdFx0LnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHthcHBsaWNhdGlvbnM6IFtdfSkpO1xuXHRjb25zdCBzdHViMiA9IHNpbm9uLnN0dWIoKDxhbnk+YXBpKS5jYXRhcHVsdC5BcHBsaWNhdGlvbiwgJ2NyZWF0ZScpXG5cdFx0LndpdGhBcmdzKHtcblx0XHRcdG5hbWU6ICdOb2RlSlNWb2ljZVJlZmVyZW5jZUFwcCBvbiBsb2NhbGhvc3QnLFxuXHRcdFx0YXV0b0Fuc3dlcjogdHJ1ZSxcblx0XHRcdGluY29taW5nQ2FsbFVybDogJ2h0dHA6Ly9sb2NhbGhvc3QvY2FsbENhbGxiYWNrJ1xuXHRcdH0pXG5cdFx0LnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHtpZDogJ2FwcElkJ30pKTtcblx0dC5pcyhhd2FpdCAoPGFueT5hcGkpLmdldEFwcGxpY2F0aW9uSWQoY3JlYXRlQ29udGV4dCgpKSwgJ2FwcElkJyk7XG5cdHQudHJ1ZShzdHViMS5jYWxsZWQpO1xuXHR0LnRydWUoc3R1YjIuY2FsbGVkKTtcbn0pO1xuXG50ZXN0KGBDYXRhcHVsdEFwaSNnZXREb21haW4gc2hvdWxkIHJldHVybiBleGlzdGluZyBkb21haW4gaW5mbyBpZiB0aGUgZG9tYWluIGV4aXN0c2AsIGFzeW5jICh0KSA9PiB7XG5cdGNvbnN0IGFwaSA9IGNyZWF0ZUNhdGFwdWx0QXBpKCk7XG5cdGNvbnN0IGRvbWFpbnMgPSBbXG5cdFx0e1x0aWQ6ICdkb21haW5JZCcsXHRuYW1lOiAnZG9tYWluJywgZGVzY3JpcHRpb246IGBOb2RlSlNWb2ljZVJlZmVyZW5jZUFwcCdzIGRvbWFpbmAgfVxuXHRdO1xuXHRjb25zdCBzdHViMSA9IHNpbm9uLnN0dWIoKDxhbnk+YXBpKS5jYXRhcHVsdC5Eb21haW4sICdsaXN0Jylcblx0XHQud2l0aEFyZ3MoeyBzaXplOiAxMDAgfSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2RvbWFpbnN9KSk7XG5cdHQuZGVlcEVxdWFsKGF3YWl0ICg8YW55PmFwaSkuZ2V0RG9tYWluKGNyZWF0ZUNvbnRleHQoKSksIHtcdGlkOiAnZG9tYWluSWQnLFx0bmFtZTogJ2RvbWFpbicgfSk7XG5cdHQudHJ1ZShzdHViMS5jYWxsZWQpO1xufSk7XG5cbnRlc3QoYENhdGFwdWx0QXBpI2dldERvbWFpbiBzaG91bGQgcmV0dXJuIGNhY2hlZCBkb21haW4gaW5mbyBvbiBzZWNvbmQgY2FsbGAsIGFzeW5jICh0KSA9PiB7XG5cdGNvbnN0IGFwaSA9IGNyZWF0ZUNhdGFwdWx0QXBpKCk7XG5cdGNvbnN0IGRvbWFpbnMgPSBbXG5cdFx0e1x0aWQ6ICdkb21haW5JZCcsXHRuYW1lOiAnZG9tYWluJywgZGVzY3JpcHRpb246IGBOb2RlSlNWb2ljZVJlZmVyZW5jZUFwcCdzIGRvbWFpbmAgfVxuXHRdO1xuXHRjb25zdCBzdHViMSA9IHNpbm9uLnN0dWIoKDxhbnk+YXBpKS5jYXRhcHVsdC5Eb21haW4sICdsaXN0Jylcblx0XHQud2l0aEFyZ3MoeyBzaXplOiAxMDAgfSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2RvbWFpbnN9KSk7XG5cdHQuZGVlcEVxdWFsKGF3YWl0ICg8YW55PmFwaSkuZ2V0RG9tYWluKGNyZWF0ZUNvbnRleHQoKSksIHtcdGlkOiAnZG9tYWluSWQnLFx0bmFtZTogJ2RvbWFpbicgfSk7XG5cdHQuZGVlcEVxdWFsKGF3YWl0ICg8YW55PmFwaSkuZ2V0RG9tYWluKGNyZWF0ZUNvbnRleHQoKSksIHtcdGlkOiAnZG9tYWluSWQnLFx0bmFtZTogJ2RvbWFpbicgfSk7XG5cdHQuaXMoc3R1YjEuY2FsbENvdW50LCAxKTtcbn0pO1xuXG50ZXN0KGBDYXRhcHVsdEFwaSNnZXREb21haW4gc2hvdWxkIGNyZWF0ZSBuZXcgZG9tYWluYCwgYXN5bmMgKHQpID0+IHtcblx0Y29uc3QgYXBpID0gY3JlYXRlQ2F0YXB1bHRBcGkoKTtcblx0Y29uc3QgbmFtZSA9ICdyYW5kb21yYW5kb20nO1xuXHRjb25zdCBzdHViMSA9IHNpbm9uLnN0dWIoKDxhbnk+YXBpKS5jYXRhcHVsdC5Eb21haW4sICdsaXN0Jylcblx0XHQud2l0aEFyZ3MoeyBzaXplOiAxMDAgfSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2RvbWFpbnM6IFtdfSkpO1xuXHRjb25zdCBzdHViMiA9IHNpbm9uLnN0dWIoKDxhbnk+YXBpKS5jYXRhcHVsdC5Eb21haW4sICdjcmVhdGUnKVxuXHRcdC53aXRoQXJncyh7IG5hbWUsIGRlc2NyaXB0aW9uOiBgTm9kZUpTVm9pY2VSZWZlcmVuY2VBcHAncyBkb21haW5gIH0pXG5cdFx0LnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHtcdGlkOiAnZG9tYWluSWQnLFx0bmFtZSB9KSk7XG5cdHQuZGVlcEVxdWFsKGF3YWl0ICg8YW55PmFwaSkuZ2V0RG9tYWluKGNyZWF0ZUNvbnRleHQoKSksIHtcdGlkOiAnZG9tYWluSWQnLFx0bmFtZSB9KTtcblx0dC50cnVlKHN0dWIxLmNhbGxlZCk7XG5cdHQudHJ1ZShzdHViMi5jYWxsZWQpO1xufSk7XG5cbnRlc3QoYENhdGFwdWx0QXBpI2NyZWF0ZVBob25lTnVtYmVyIHNob3VsZCBzZWFyY2ggYW5kIHJlZ2lzdGVyIGEgcGhvbmUgbnVtYmVyYCwgYXN5bmMgKHQpID0+IHtcblx0Y29uc3QgYXBpID0gY3JlYXRlQ2F0YXB1bHRBcGkoKTtcblx0Y29uc3Qgc3R1YjEgPSBzaW5vbi5zdHViKCg8YW55PmFwaSkuY2F0YXB1bHQuQXZhaWxhYmxlTnVtYmVyLCAnc2VhcmNoQW5kT3JkZXInKVxuXHRcdC53aXRoQXJncygnbG9jYWwnLCB7IGFyZWFDb2RlOiAnOTEwJywgcXVhbnRpdHk6IDEgfSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoW3tpZDogJ2lkJywgbnVtYmVyOiAnKzEyMzQ1Njc4OTAnfV0pKTtcblx0Y29uc3Qgc3R1YjIgPSBzaW5vbi5zdHViKCg8YW55PmFwaSkuY2F0YXB1bHQuUGhvbmVOdW1iZXIsICd1cGRhdGUnKVxuXHRcdC53aXRoQXJncygnaWQnLCB7IGFwcGxpY2F0aW9uSWQ6ICdhcHBJZCcgfSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoKSk7XG5cdGNvbnN0IHN0dWIzID0gc2lub24uc3R1YigoPGFueT5hcGkpLCAnZ2V0QXBwbGljYXRpb25JZCcpXG5cdFx0LnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKCdhcHBJZCcpKTtcblx0dC5pcyhhd2FpdCBhcGkuY3JlYXRlUGhvbmVOdW1iZXIoY3JlYXRlQ29udGV4dCgpLCAnOTEwJyksICcrMTIzNDU2Nzg5MCcpO1xuXHR0LnRydWUoc3R1YjEuY2FsbGVkKTtcblx0dC50cnVlKHN0dWIyLmNhbGxlZCk7XG5cdHQudHJ1ZShzdHViMy5jYWxsZWQpO1xufSk7XG5cbnRlc3QoYENhdGFwdWx0QXBpI2NyZWF0ZVNJUEFjY291bnQgc2hvdWxkIGNyZWF0ZSBzaXAgYWNjb3VudCBmb3IgdGhlIGFwcGAsIGFzeW5jICh0KSA9PiB7XG5cdGNvbnN0IGFwaSA9IGNyZWF0ZUNhdGFwdWx0QXBpKCk7XG5cdGNvbnN0IHN0dWIxID0gc2lub24uc3R1YigoPGFueT5hcGkpLmNhdGFwdWx0LkVuZHBvaW50LCAnY3JlYXRlJylcblx0XHQud2l0aEFyZ3MoJ2RvbWFpbklkJywge1xuXHRcdFx0YXBwbGljYXRpb25JZDogJ2FwcElkJyxcblx0XHRcdGRvbWFpbklkOiAnZG9tYWluSWQnLFxuXHRcdFx0bmFtZTogJ3Z1LXJhbmRvbScsXG5cdFx0XHRkZXNjcmlwdGlvbjogYE5vZGVKU1ZvaWNlUmVmZXJlbmNlQXBwJ3MgU0lQIEFjY291bnRgLFxuXHRcdFx0Y3JlZGVudGlhbHM6IHtwYXNzd29yZDogJ3JhbmRvbSd9XG5cdFx0fSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2lkOiAnaWQnfSkpO1xuXHRjb25zdCBzdHViMiA9IHNpbm9uLnN0dWIoKDxhbnk+YXBpKSwgJ2dldEFwcGxpY2F0aW9uSWQnKVxuXHRcdC5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSgnYXBwSWQnKSk7XG5cdGNvbnN0IHN0dWIzID0gc2lub24uc3R1YigoPGFueT5hcGkpLCAnZ2V0RG9tYWluJylcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2lkOiAnZG9tYWluSWQnLCBuYW1lOiAnZG9tYWluJ30pKTtcblx0dC5kZWVwRXF1YWwoYXdhaXQgYXBpLmNyZWF0ZVNJUEFjY291bnQoY3JlYXRlQ29udGV4dCgpKSwge1xuXHRcdGVuZHBvaW50SWQ6ICdpZCcsXG5cdFx0dXJpOiAnc2lwOnZ1LXJhbmRvbUBkb21haW4uYndhcHAuYndzaXAuaW8nLFxuXHRcdHBhc3N3b3JkOiAncmFuZG9tJ1xuXHR9KTtcblx0dC50cnVlKHN0dWIxLmNhbGxlZCk7XG5cdHQudHJ1ZShzdHViMi5jYWxsZWQpO1xuXHR0LnRydWUoc3R1YjMuY2FsbGVkKTtcbn0pO1xuXG50ZXN0KGBDYXRhcHVsdEFwaSNjcmVhdGVTSVBBdXRoVG9rZW4gc2hvdWxkIGNyZWF0ZSBhdXRoIHRva2VuIGZvciBTSVAgYWNjb3VudGAsIGFzeW5jICh0KSA9PiB7XG5cdGNvbnN0IGFwaSA9IGNyZWF0ZUNhdGFwdWx0QXBpKCk7XG5cdGNvbnN0IHN0dWIxID0gc2lub24uc3R1YigoPGFueT5hcGkpLCAnZ2V0RG9tYWluJylcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2lkOiAnZG9tYWluSWQnLCBuYW1lOiAnZG9tYWluJ30pKTtcblx0Y29uc3Qgc3R1YjIgPSBzaW5vbi5zdHViKCg8YW55PmFwaSkuY2F0YXB1bHQuRW5kcG9pbnQsICdjcmVhdGVBdXRoVG9rZW4nKVxuXHRcdC53aXRoQXJncygnZG9tYWluSWQnLCAnZW5kcG9pbnRJZCcsIHtleHBpcmVzOiAzNjAwfSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2V4cGlyZXM6IDM2MDAsIHRva2VuOiAndG9rZW4nfSkpO1xuXHR0LmRlZXBFcXVhbChhd2FpdCBhcGkuY3JlYXRlU0lQQXV0aFRva2VuKGNyZWF0ZUNvbnRleHQoKSwgJ2VuZHBvaW50SWQnKSwge2V4cGlyZXM6IDM2MDAsIHRva2VuOiAndG9rZW4nfSk7XG5cdHQudHJ1ZShzdHViMS5jYWxsZWQpO1xuXHR0LnRydWUoc3R1YjIuY2FsbGVkKTtcbn0pO1xuXG50ZXN0KGBDYXRhcHVsdEFwaSNjcmVhdGVCcmlkZ2Ugc2hvdWxkIGNyZWF0ZSBhIGJyaWRnZWAsIGFzeW5jICh0KSA9PiB7XG5cdGNvbnN0IGFwaSA9IGNyZWF0ZUNhdGFwdWx0QXBpKCk7XG5cdGNvbnN0IGRhdGEgPSB7Y2FsbElkczogWydjYWxsSWQnXX07XG5cdGNvbnN0IHN0dWIgPSBzaW5vbi5zdHViKCg8YW55PmFwaSkuY2F0YXB1bHQuQnJpZGdlLCAnY3JlYXRlJylcblx0XHQud2l0aEFyZ3MoZGF0YSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2lkOiAnaWQnfSkpO1xuXHR0LmlzKGF3YWl0IGFwaS5jcmVhdGVCcmlkZ2UoZGF0YSksICdpZCcpO1xuXHR0LnRydWUoc3R1Yi5jYWxsZWQpO1xufSk7XG5cbnRlc3QoYENhdGFwdWx0QXBpI2NyZWF0ZUNhbGwgc2hvdWxkIGNyZWF0ZSBhIGJyaWRnZWAsIGFzeW5jICh0KSA9PiB7XG5cdGNvbnN0IGFwaSA9IGNyZWF0ZUNhdGFwdWx0QXBpKCk7XG5cdGNvbnN0IGRhdGEgPSB7ZnJvbTogJ251bWJlcjEnLCB0bzogJ251bWJlcjInfTtcblx0Y29uc3Qgc3R1YiA9IHNpbm9uLnN0dWIoKDxhbnk+YXBpKS5jYXRhcHVsdC5DYWxsLCAnY3JlYXRlJylcblx0XHQud2l0aEFyZ3MoZGF0YSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2lkOiAnaWQnfSkpO1xuXHR0LmlzKGF3YWl0IGFwaS5jcmVhdGVDYWxsKGRhdGEpLCAnaWQnKTtcblx0dC50cnVlKHN0dWIuY2FsbGVkKTtcbn0pO1xuXG50ZXN0KGBDYXRhcHVsdEFwaSNjcmVhdGVHYXRoZXIgc2hvdWxkIGNyZWF0ZSBhIGdhdGhlciBmb3IgYSBjYWxsYCwgYXN5bmMgKHQpID0+IHtcblx0Y29uc3QgYXBpID0gY3JlYXRlQ2F0YXB1bHRBcGkoKTtcblx0Y29uc3QgZGF0YSA9IHttYXhEaWdpdHM6IDF9O1xuXHRjb25zdCBzdHViID0gc2lub24uc3R1YigoPGFueT5hcGkpLmNhdGFwdWx0LkNhbGwsICdjcmVhdGVHYXRoZXInKVxuXHRcdC53aXRoQXJncygnY2FsbElkJywgZGF0YSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2lkOiAnaWQnfSkpO1xuXHR0LmlzKGF3YWl0IGFwaS5jcmVhdGVHYXRoZXIoJ2NhbGxJZCcsIGRhdGEpLCAnaWQnKTtcblx0dC50cnVlKHN0dWIuY2FsbGVkKTtcbn0pO1xuXG50ZXN0KGBDYXRhcHVsdEFwaSN1cGRhdGVDYWxsIHNob3VsZCB1cGRhdGUgY2FsbCBkYXRhYCwgYXN5bmMgKHQpID0+IHtcblx0Y29uc3QgYXBpID0gY3JlYXRlQ2F0YXB1bHRBcGkoKTtcblx0Y29uc3QgZGF0YSA9IHtzdGF0ZTogJ2NvbXBsZXRlZCd9O1xuXHRjb25zdCBzdHViID0gc2lub24uc3R1YigoPGFueT5hcGkpLmNhdGFwdWx0LkNhbGwsICd1cGRhdGUnKVxuXHRcdC53aXRoQXJncygnY2FsbElkJywgZGF0YSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoKSk7XG5cdGF3YWl0IGFwaS51cGRhdGVDYWxsKCdjYWxsSWQnLCBkYXRhKTtcblx0dC50cnVlKHN0dWIuY2FsbGVkKTtcbn0pO1xuXG50ZXN0KGBDYXRhcHVsdEFwaSNzdG9wUGxheUF1ZGlvVG9DYWxsIHNob3VsZCBzdG9wIGF1ZGlvYCwgYXN5bmMgKHQpID0+IHtcblx0Y29uc3QgYXBpID0gY3JlYXRlQ2F0YXB1bHRBcGkoKTtcblx0Y29uc3Qgc3R1YiA9IHNpbm9uLnN0dWIoKDxhbnk+YXBpKS5jYXRhcHVsdC5DYWxsLCAncGxheUF1ZGlvQWR2YW5jZWQnKVxuXHRcdC53aXRoQXJncygnY2FsbElkJywgeyBmaWxlVXJsOiAnJyB9KVxuXHRcdC5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSgpKTtcblx0YXdhaXQgYXBpLnN0b3BQbGF5QXVkaW9Ub0NhbGwoJ2NhbGxJZCcpO1xuXHR0LnRydWUoc3R1Yi5jYWxsZWQpO1xufSk7XG5cbnRlc3QoYENhdGFwdWx0QXBpI3BsYXlBdWRpb1RvQ2FsbCBzaG91bGQgcGxheSBhdWRpbyBmaWxlYCwgYXN5bmMgKHQpID0+IHtcblx0Y29uc3QgYXBpID0gY3JlYXRlQ2F0YXB1bHRBcGkoKTtcblx0Y29uc3Qgc3R1YiA9IHNpbm9uLnN0dWIoKDxhbnk+YXBpKS5jYXRhcHVsdC5DYWxsLCAncGxheUF1ZGlvQWR2YW5jZWQnKVxuXHRcdC53aXRoQXJncygnY2FsbElkJywgeyBmaWxlVXJsOiAndXJsJywgdGFnOiAndGFnJywgbG9vcEVuYWJsZWQ6IGZhbHNlIH0pXG5cdFx0LnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKCkpO1xuXHRhd2FpdCBhcGkucGxheUF1ZGlvVG9DYWxsKCdjYWxsSWQnLCAndXJsJywgZmFsc2UsICd0YWcnKTtcblx0dC50cnVlKHN0dWIuY2FsbGVkKTtcbn0pO1xuXG50ZXN0KGBDYXRhcHVsdEFwaSNzcGVha1NlbnRlbmNlVG9DYWxsIHNob3VsZCBzcGVhayBhIHNlbnRlbmNlYCwgYXN5bmMgKHQpID0+IHtcblx0Y29uc3QgYXBpID0gY3JlYXRlQ2F0YXB1bHRBcGkoKTtcblx0Y29uc3Qgc3R1YiA9IHNpbm9uLnN0dWIoKDxhbnk+YXBpKS5jYXRhcHVsdC5DYWxsLCAncGxheUF1ZGlvQWR2YW5jZWQnKVxuXHRcdC53aXRoQXJncygnY2FsbElkJywgeyBzZW50ZW5jZTogJ0hlbGxvJywgIHRhZzogJ3RhZycgfSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoKSk7XG5cdGF3YWl0IGFwaS5zcGVha1NlbnRlbmNlVG9DYWxsKCdjYWxsSWQnLCAnSGVsbG8nLCAndGFnJyk7XG5cdHQudHJ1ZShzdHViLmNhbGxlZCk7XG59KTtcblxudGVzdChgQ2F0YXB1bHRBcGkjdHJhbnNmZXJDYWxsIHNob3VsZCB0cmFuc2ZlciBjYWxsIHRvIGFub3RoZXIgY2FsbGAsIGFzeW5jICh0KSA9PiB7XG5cdGNvbnN0IGFwaSA9IGNyZWF0ZUNhdGFwdWx0QXBpKCk7XG5cdGNvbnN0IHN0dWIgPSBzaW5vbi5zdHViKCg8YW55PmFwaSkuY2F0YXB1bHQuQ2FsbCwgJ3RyYW5zZmVyJylcblx0XHQud2l0aEFyZ3MoJ2NhbGxJZCcsIHt0cmFuc2ZlclRvOiAnKzEyMzQ1Njc4OTAnLCB0cmFuc2ZlckNhbGxlcklkOiAnY2FsbGVySWQnfSlcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2lkOiAnaWQnfSkpO1xuXHR0LmlzKGF3YWl0IGFwaS50cmFuc2ZlckNhbGwoJ2NhbGxJZCcsICcrMTIzNDU2Nzg5MCcsICdjYWxsZXJJZCcpLCAnaWQnKTtcblx0dC50cnVlKHN0dWIuY2FsbGVkKTtcbn0pO1xuXG50ZXN0KGBDYXRhcHVsdEFwaSNnZXRDYWxsIHNob3VsZCByZXR1cm4gYSBjYWxsIGRhdGFgLCBhc3luYyAodCkgPT4ge1xuXHRjb25zdCBhcGkgPSBjcmVhdGVDYXRhcHVsdEFwaSgpO1xuXHRjb25zdCBzdHViID0gc2lub24uc3R1YigoPGFueT5hcGkpLmNhdGFwdWx0LkNhbGwsICdnZXQnKVxuXHRcdC53aXRoQXJncygnY2FsbElkJylcblx0XHQucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe2NhbGxJZDogJ2lkJ30pKTtcblx0dC5kZWVwRXF1YWwoYXdhaXQgYXBpLmdldENhbGwoJ2NhbGxJZCcpLCB7Y2FsbElkOiAnaWQnfSk7XG5cdHQudHJ1ZShzdHViLmNhbGxlZCk7XG59KTtcblxudGVzdChgQ2F0YXB1bHRBcGkjZ2V0UmVjb3JkaW5nIHNob3VsZCByZXR1cm4gYSBjYWxsIGRhdGFgLCBhc3luYyAodCkgPT4ge1xuXHRjb25zdCBhcGkgPSBjcmVhdGVDYXRhcHVsdEFwaSgpO1xuXHRjb25zdCBzdHViID0gc2lub24uc3R1YigoPGFueT5hcGkpLmNhdGFwdWx0LlJlY29yZGluZywgJ2dldCcpXG5cdFx0LndpdGhBcmdzKCdyZWNvcmRpbmdJZCcpXG5cdFx0LnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHttZWRpYTogJ3VybCd9KSk7XG5cdHQuZGVlcEVxdWFsKGF3YWl0IGFwaS5nZXRSZWNvcmRpbmcoJ3JlY29yZGluZ0lkJyksIHttZWRpYTogJ3VybCd9KTtcblx0dC50cnVlKHN0dWIuY2FsbGVkKTtcbn0pO1xuXG50ZXN0KGBDYXRhcHVsdEFwaSNoYW5ndXAgc2hvdWxkIGNvbXBsZXRlIGEgY2FsbGAsIGFzeW5jICh0KSA9PiB7XG5cdGNvbnN0IGFwaSA9IGNyZWF0ZUNhdGFwdWx0QXBpKCk7XG5cdGNvbnN0IHN0dWIgPSBzaW5vbi5zdHViKCg8YW55PmFwaSkuY2F0YXB1bHQuQ2FsbCwgJ3VwZGF0ZScpXG5cdFx0LndpdGhBcmdzKCdjYWxsSWQnLCB7IHN0YXRlOiAnY29tcGxldGVkJyB9KVxuXHRcdC5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSgpKTtcblx0YXdhaXQgYXBpLmhhbmd1cCgnY2FsbElkJyk7XG5cdHQudHJ1ZShzdHViLmNhbGxlZCk7XG59KTtcblxudGVzdChgQ2F0YXB1bHRBcGkjZG93bmxvYWRNZWRpYUZpbGUgc2hvdWxkIGRvd25sb2FkIGEgbWVkaWEgZmlsZWAsIGFzeW5jICh0KSA9PiB7XG5cdGNvbnN0IGFwaSA9IGNyZWF0ZUNhdGFwdWx0QXBpKCk7XG5cdGNvbnN0IGRhdGEgPSB7Y29udGVudDogJzEyMzQnLCBjb250ZW50VHlwZTogJ3RleHQvcGxhaW4nfTtcblx0Y29uc3Qgc3R1YiA9IHNpbm9uLnN0dWIoKDxhbnk+YXBpKS5jYXRhcHVsdC5NZWRpYSwgJ2Rvd25sb2FkJylcblx0XHQud2l0aEFyZ3MoJ25hbWUnKVxuXHRcdC5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShkYXRhKSk7XG5cdHQuZGVlcEVxdWFsKGF3YWl0IGFwaS5kb3dubG9hZE1lZGlhRmlsZSgnbmFtZScpLCBkYXRhKTtcblx0dC50cnVlKHN0dWIuY2FsbGVkKTtcbn0pO1xuXG5mdW5jdGlvbiBjcmVhdGVDYXRhcHVsdEFwaSgpOiBJQ2F0YXB1bHRBcGkge1xuXHRyZXR1cm4gbmV3IENhdGFwdWx0QXBpKCd1c2VySWQnLCAnYXBpVG9rZW4nLCAnYXBpU2VjcmV0Jyk7XG59XG5cbiJdfQ==